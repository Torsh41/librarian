Взаимодействие веб-сайта и API
==============================

Под API будем понимать как непосредственную реализацию сервера,
обеспечивающего взаимодействие пользовательского интерфейса
(веб-страницы) и остальных элементов системы, так и описание
правил взаимодейстия с данным сервером (см. приложенную
обновлённую спецификацию).

API-сервер представляет собой REST API приложение, реализованное
на Rust и слушающее некоторый TCP-порт, доступный извне.

## Аутентификация

Взаимодействие пользователя с веб-сайтом будет проходить
следующим образом:

1. Пользователь вводит учётные данные на странице логина в
   HTML-форму и нажимает "Войти";

2. Браузерный Javascript:

    * валидирует поля (проверяет на допустимые символы, длину,
    ...)

    * отправляет данные для валидации API-серверу

3. API-сервер сверяет логин и хэш пароля с записанными в БД
    пользователей

4. В случае успеха, API-сервер возвращает JSON-ответ
    браузерному Javascript с id пользователя и API-ключом

5. Браузерный Javascript записывает пару id:ключ в localStorage
   и в cookie браузера

> Полезные ресурсы: 
> * [https://dev.to/thedevdrawer/login-validation-authentication-using-vanilla-javascript-4i45]
> * [https://www.w3schools.com/js/js_cookies.asp]

От наличия данных аутентификации в localStorage и в cookie будет
зависеть, какие страницы и функции доступны пользователю.
Полагаю, самым простым и разумным способом взаимодействия сайта
с API будет JS-функция `fetch`.


## Работа с файлами

Взаимодействие с файлами происходит посредством взаимодействия с
API-сервером. API-сервер берёт на себя специфику работы с
файловой системой, предоставляя фронтенд-разработчику REST API
(см. спецификацию).

Файловая система `ext4` выбрана, так как она: 

1. стабильна - в отличие от `btrfs`, всё ещё являющейся в
   некоторой степени экспериментальной технологией;

2. почти не фрагментируется - в отличие от `btrfs` и `ntfs`;

3. нативно поддерживается большинством серверных
   Linux-дистрибутивов.


## База данных

Дополнительных баз данных не требуется. Таблицы текущей базы
данных (дискуссионный вопрос):

1. Данные о пользователях - userid, юзернейм, пароль, api-ключ,
   роль

2. Данные о хранящихся файлах - fileid, название, путь в
   файловой системе, описание

3. Данные о постах - postid, заголовок, тело, соотв. fileid,
   соотв. threadid

4. Комментарии - commentid, threadid, userid, текст

Необходимость просмотра файлов - вопрос также дискуссионный. Для
просмотра PDF можно использовать веб-приложение по типу PDF.js.
